name: Deploy a Beta Release
on:
  push:
    branches: [ beta ]
    paths-ignore:
      - '**/*.md'
      - '**/*.gitignore'
      - '**/*.gitattributes'
      - '.github/**/*.yml'
  pull_request:
    branches: [ beta ]
  workflow_dispatch:
permissions:
  contents: read
jobs:
  deploy:
    runs-on: ubuntu-latest
    name: Deploy to Beta (Google Play)
    steps:
    - name: Checkout
      uses: actions/checkout@v4.1.1
      with:
        fetch-depth: 0
    - name: Install GitVersion
      uses: gittools/actions/gitversion/setup@v0.10.2
      with:
        versionSpec: '5.x'
        preferLatestVersion: true
    - name: Determine Version
      id: gitversion
      uses: gittools/actions/gitversion/execute@v0.10.2
      with:
        useConfigFile: true
    - name: Download workflow artifact
      uses: dawidd6/action-download-artifact@v2.28.0
      with:
        workflow: build.yml
        branch: ${{ github.ref_name }}
        name: bundle-${{ steps.gitversion.outputs.semVer }}
        allow_forks: false
    - name: Download Bundle
      uses: actions/download-artifact@v3.0.2
      with:
        name: bundle-${{ steps.gitversion.outputs.semVer}}
    - name: Submit a Beta Release
      uses: r0adkll/upload-google-play@v1.0.19
      with:
        serviceAccountJsonPlainText: ${{ secrets.SERVICES_ACCOUNT_JSON }}
        packageName: app.rosy_crow
        releaseFile: app.rosy_crow-Signed.aab
        releaseName: ${{ steps.gitversion.outputs.semVer }}
        track: beta
        mappingFile: mappings.txt
        status: completed

        
